<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title><%= @title || CONFIG[:title] %></title>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <%= javascript_include_tag :defaults %>
    <script type="text/javascript" src="http://www.google.com/jsapi?key=ABQIAAAAAw-Wv07EcXs7QUUotGk2xBT-j_dSY6Ha2ajsKWuztfDBCn8orhRSoxcY4r_el1-87g0n7K5Zdh5bfA"></script>
    <%= yield :javascript %>
    <link rel="stylesheet" href="/stylesheets/reset.css" type="text/css" />
    <link rel="stylesheet" href="/stylesheets/style.css" type="text/css" />
    <meta name="title" content="<%= CONFIG[:sharing_title] %>" />
    <meta name="description" content="<%= CONFIG[:sharing_body] %>" />
    <link rel="image_src" href="<%= image_path "sharing_image.png" %>" />

    <script src="http://connect.facebook.net/de_DE/all.js"></script>
    <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId: '120956097919751',
          status: true, // check login status
          cookie: true, // enable cookies to allow the server to access the session
          xfbml: true  // parse XFBML
          //apiKey: 'ca1fb858a2abcd760a8d924b9a4bd8c0'
        });
        FB.Event.subscribe('auth.sessionChange', function(response) {
          if (response.session) {
            // A user has logged in, and a new cookie has been saved
            // if we have a session, query for the user's profile picture and name
            FB.api(
              {
                method: 'fql.query',
                query: 'SELECT name, pic FROM profile WHERE id=' + FB.getSession().uid
              },
              function(response) {
                var user = response[0];
                var userInfo = document.getElementById('fb-userinfo');
                userInfo.innerHTML = '<img src="' + user.pic + '">' + user.name;
              }
            );
          } else {
            // The user has logged out, and the cookie has been cleared
            clearDisplay();
            return;
         }
        });
        //FB.getLoginStatus(handleSessionResponse); // fetch the status on load
        //Event.observe($('fb-login'), 'click', function() {
        //  FB.login(handleSessionResponse);
        //});
        //Event.observe($('fb-logout'), 'click', function() {
        //  FB.logout(handleSessionResponse);
        //});
        //$('disconnect').observe('click', function() {
        //  FB.api({ method: 'Auth.revokeAuthorization' }, function(response) {
        //    clearDisplay();
        //  });
        //});
        function clearDisplay() { // no user, clear display
          document.getElementById('fb-userinfo').innerHTML = '';
        }
      }
    </script>
  </head>

  <body>
  <% unless @hide_header %>
      <div id="container">
        
        <ul id="topmenu">
          <li><a href="">Wer?</a></li>
          <li><a href="">Was?</a></li>
            <li<%= " class=\"active\"" unless ['static', 'questions'].include?(@controller.controller_name) %>>
              <%= link_to "Mitmachen", root_path %>
            </li>
          <li<%= " class=\"active\"" if @controller.controller_name == 'questions' %>>
            <%= link_to "Fragen &amp; Antworten", question_list_path %>
          </li>
        </ul>
            
        <div id="menucontainer">
          <% if logged_in? %>
            <div id="loggedin">Hallo <strong><%= current_user.name %></strong>!</div>
          <% end %>

          <ul class="menu">

            <% unless ['static', 'questions'].include?(@controller.controller_name) %>
              <li<%= " class=\"active\"" if @controller.controller_name == 'geo' %>>
                <%= link_to "Unterstützer werden", root_path %>
              </li>
              <!--li<%= " class=\"active\"" if @controller.controller_name == 'videos' %>>
                <%= link_to "Video-Statements", video_path %>
              </li-->
              <li<%= " class=\"active\"" if @controller.controller_name == 'events' %>>
                <%= link_to "Treffen", event_list_path %>
              </li>
              <li<%= " class=\"active\"" if @controller.controller_name == 'tasks' %>>
                <%= link_to "Projekte", tasks_path %>
              </li>
              <li<%= " class=\"active\"" if @controller.controller_name == 'ideas' %>>
                <%= link_to "Ideen einbringen", ideas_path %>
              </li>
              <li<%= " class=\"active\"" if @controller.controller_name == 'elsewhere' %>>
                <%= link_to "Armin im Web", elsewhere_path %>
              </li>
              <!--li<%= " class=\"active\"" if 1==0 %>>
                <%= link_to "Über diese Seite", '/about' %>
              </li-->
            <% end %>
            
          </ul>
          <!--ul class="menu menu_secondary">
            <li<%= " class=\"active\"" if @controller.action_name == 'about' %>>
              <%#= link_to "Über diese Seite", about_path %>
            </li>
          </ul-->
        </div>
    <% end %>  
      <div id="content">  
  
        <%= yield %>
  
        <div class="footer boxrow">
          <a href="/impressum">Impressum</a> &nbsp;
          <a href="/datenschutz">Datenschutz</a> &nbsp;
          <a href="mailto:arminsoyka@c3o.org">Anfragen</a>
          &nbsp; &ndash; &nbsp; (cc) openCampaign 0.1a by <a href="mailto:opencampaign@c3o.org">Christopher Clay</a>
        </div><br /><br />
      </div>

    <% unless @hide_header %>
      </div><!-- container -->
    <% end %>    

    <% if !logged_in? && @render_signup_overlay %>
      <%= render :partial => 'shared/signup' %>
    <% end %>
  </body>
</html>